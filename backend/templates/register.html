{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register | Grievance Redressal</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'citizen/register.css' %}" />
</head>
<body class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 min-h-screen flex items-center justify-center">

  <div class="w-full max-w-4xl bg-white rounded-3xl shadow-2xl overflow-hidden grid md:grid-cols-2">

    <!-- Left Panel: Illustration & Gradient -->
    <div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 p-10 flex flex-col justify-center items-center relative">
      <h1 class="text-white text-4xl font-bold mb-4">Join Us!</h1>
      <p class="text-indigo-200 text-center mb-6">Create your account and submit grievances easily.</p>
      {% comment %} <img src="{% static 'citizen/register-illustration.svg' %}" alt="Register Illustration" class="w-3/4 animate-bounce"> {% endcomment %}
      <div class="absolute bottom-5 text-indigo-100 text-sm opacity-75">www.grievanceredressal.com</div>
    </div>

    <!-- Right Panel: Form -->
    <div class="p-10 flex flex-col justify-center relative">
      <h2 class="text-3xl font-bold text-gray-700 mb-6">Create Account</h2>
      
      <form id="registerForm" class="space-y-6">
        <!-- Username -->
        <div>
          <label for="username" class="block text-gray-600 font-medium mb-2">Username</label>
          <input
            type="text"
            id="username"
            placeholder="Enter your username"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition duration-300"
            required
          />
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-gray-600 font-medium mb-2">Email</label>
          <input
            type="email"
            id="email"
            placeholder="Enter your email"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition duration-300"
            required
          />
        </div>

        <!-- Password -->
        <div>
          <label for="password" class="block text-gray-600 font-medium mb-2">Password</label>
          <input
            type="password"
            id="password"
            placeholder="Enter your password"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition duration-300"
            required
          />
        </div>

        <!-- Confirm Password -->
        <div>
          <label for="confirmPassword" class="block text-gray-600 font-medium mb-2">Confirm Password</label>
          <input
            type="password"
            id="confirmPassword"
            placeholder="Confirm your password"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition duration-300"
            required
          />
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full py-3 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white font-bold rounded-xl shadow-lg hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300"
        >
          Register
        </button>
      </form>

      <!-- Login Link -->
      <p class="mt-6 text-center text-gray-500">
        Already have an account? 
        <a href="{% url 'login' %}" class="text-indigo-600 font-semibold hover:underline">Login here</a>
      </p>

      <!-- Decorative Circles -->
      <div class="absolute -top-10 -right-10 w-32 h-32 bg-pink-300 rounded-full opacity-50 animate-pulse"></div>
      <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-indigo-300 rounded-full opacity-50 animate-pulse"></div>
    </div>

  </div>

  <!-- JS for Register -->
  <script>
    const registerForm = document.getElementById('registerForm');

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();

      if (!username || !email || !password || !confirmPassword) {
        alert('Please fill all fields.');
        return;
      }

      if (password !== confirmPassword) {
        alert('Passwords do not match!');
        return;
      }

      try {
        const response = await fetch('/api/v1/citizen/register/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email, password })
        });

        if (!response.ok) {
          throw new Error('Registration failed! Check credentials.');
        }

        const data = await response.json();
        alert('Registration successful! You can now login.');
        window.location.href = '/login/';
      } catch (err) {
        alert(err.message);
      }
    });
  </script>

</body>
</html>
